#!/bin/bash
#
# bandit-set - Set enviromment variables for BANDIT
#
# Copyright (C) 2015-2018 Angel Linares Zapater
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License, version 2, as 
# published by the Free Software Foundation. See the COPYING file.
#
# This program is distributed WITHOUT ANY WARRANTY; without even the 
# implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  
#

###----------------------------------------
# Prepare the environment for BANDIT
###----------------------------------------

# Remove BANDIT_HOME from PATH
if [ "$BANDIT_HOME" ] ; then
    NEW=""
    OLDIFS=$IFS
    IFS=':'
    for STR in $PATH; do
        if [ "$STR" != "$BANDIT_HOME/bin" ] ; then
            NEW=${NEW:+$NEW:}$STR
        fi
    done
    IFS=$OLDIFS
    PATH=$NEW
fi

# Define BANDIT_HOME and add it to PATH   
export BANDIT_HOME=`pwd`
export PATH=$PATH:$BANDIT_HOME/bin

# Source the proper bandit bash completion shell
ln -sf $BANDIT_HOME/bin/bandit_bash_completion /etc/bash_completion.d/
source /etc/bash_completion.d/bandit_bash_completion 

# Display new enviroment
if [ "$1" != "--silent" ]; then 
    bandit --version
    echo "BANDIT environment set to:"
    echo " BANDIT_HOME=$BANDIT_HOME"
    echo " PATH="$PATH
    echo
fi
